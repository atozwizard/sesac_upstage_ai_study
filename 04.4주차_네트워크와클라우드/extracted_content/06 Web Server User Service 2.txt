25 Upstage 
웹서버 유저서비스-2 
SPEAKER 
서영학 © 2025 Upstage Co., Ltd. 
2 저작권 안내 
 
(주)업스테이지가 제공하는 모든 교육 콘텐츠의 지식재산권은 
운영 주체인 (주)업스테이지 또는 해당 저작물의 적법한 관리자에게 귀속되어 있습니다. 
콘텐츠 일부 또는 전부를 복사, 복제, 판매, 재판매 공개, 공유 등을 할 수 없습니다. 
유출될 경우 지식재산권 침해에 대한 책임을 부담할 수 있습니다. 
유출에 해당하여 금지되는 행위의 예시는 다음과 같습니다. 
● 콘텐츠를 재가공하여 온/오프라인으로 공개하는 행위 
● 콘텐츠의 일부 또는 전부를 이용하여 인쇄물을 만드는 행위 
● 콘텐츠의 전부 또는 일부를 녹취 또는 녹화하거나 녹취록을 작성하는 행위 
● 콘텐츠의 전부 또는 일부를 스크린 캡쳐하거나 카메라로 촬영하는 행위 
● 지인을 포함한 제3자에게 콘텐츠의 일부 또는 전부를 공유하는 행위 
● 다른 정보와 결합하여 Upstage Education의 콘텐츠임을 알아볼 수 있는 저작물을 작성, 공개하는 행위 
● 제공된 데이터의 일부 혹은 전부를 Upstage Education 프로젝트/실습 수행 이외의 목적으로 사용하는 행위위 
3 목표: 웹서버를 고도화해보자 (Service - Repository / Dependency, DI ) 
fastapi 
목차 
데이터 처리를 위한 Repository 
FastAPI와 DI 
- (객체지향) 책임, 위임, 사용 그리고 의존성 
- Dependency Injection 
Repository + MySQL + ORM 

4 데이터 처리를 위한 Repository 06 - 01 
Service  - Repository 
(docker-compose) mysql 
orm model - table 

5 요구사항  fastapi 
User 를 생성하는 API를 만들어주세요 
1. HTTP 요청을 받기 
- 생성이기 때문에 POST 
- 요청 포맷 정의 (request) 
- 응답 포맷 정의 (response) 
2. 유저 입력이 검증 및 기타 로직 
3. 유저 저장 
- 유저 저장 / 불러오기 
유저 id 발급 및 유저 생성할 때마다 증가 

6 (실습) 간단하게 데이터를 가지고 있을 때  fastapi 
service에서 memory_db(dict)로 저장 
service 코드 내 git switch feature/fastapi/usermemorydb 
git pull 
uv sync 

7 Service 데이터를 직접 처리하면 생기는 문제점 fastapi 
비즈니스 로직 처리를 위해선 데이터가 필요하다 
서비스 로직을 만들다 보면 반드시 데이터 처리가 필요해진다 
● 데이터 조회 
● 데이터 저장 / 수정 
● 조건에 따른 검색 
● 트랜잭션 처리 
이 모든 것을 Service가 직접 처리하면 문제가 생긴다 
● Service 코드에 DB 접근 코드가 섞인다 
● 비즈니스 로직과 저장 기술이 뒤엉킨다 
● Service의 책임이 과도하게 커진다 
Service 가 " 무엇을  할지" 보다
" 어떻게  저장할지 " 에 집중하게  된다
8 Repository 레이어의 필요성 fastapi 
Repository에 데이터 저장 방식을 위임한다 
Repository는 데이터 접근 책임을 분리한다 
Service는 "저장해야 한다, 가져와야 한다" 만 안다 
실제 저장 방식과 DB 기술은 Repository가 담당한다 
비즈니스 로직은 데이터 저장 방식을 몰라도 되어야 한다 
Service는 비즈니스에 집중하고 
Repository는 데이터 접근에 집중한다 
9 Repository fastapi 
https://aws.amazon.com/ko/what-is/repo/ 데이터를 어디서, 어떻게 가져오는지 감춰주는 중간 계층 
데이터 접근 추상화 
데이터 저장·조회 등 담당자 
데이터 매핑 
10 (실습) 메모리 기반 Repository 로 구성해보기 fastapi 
https://aws.amazon.com/ko/what-is/repo/ 실습순서 
1. repository/user_repo 생성, 저장할 데이터 포맷을 정의한다 
2. 서비스에 dict 생성 (key 로 요청이 오면 데이터를 준다, 메모리 DB) 
 
3. dict 에 넣고 성공하면 하나씩 증가하는 키를 발급해준다  
4. save, select, update, delete 로직을 추가 
5. depends 로 서비스와 연결 

11 (실습) 메모리 기반 Repository 로 구성해보기 fastapi 
https://aws.amazon.com/ko/what-is/repo/ 실습과정 
1. repository/user_repo 생성, 저장할 데이터 포맷을 정의한다 
2. 서비스에 repo 생성 (key 로 요청이 오면 데이터를 준다, 메모리 DB) 
 
3. dict 에 데이터가 들어가면 성공하면 하나씩 증가하는 키를 발급해준다  
4. 
git switch feature/fastapi/userdatarefactor 
git pull 
uv sync 
12 (실습) 메모리 기반 Repository 로 구성해보기 fastapi 
https://aws.amazon.com/ko/what-is/repo/ 실습과정 
3. dict 에 데이터가 들어가면 성공하면 
하나씩 증가하는 키를 발급해준다  
4. save, select, update, delete 로직을 추가 
git switch feature/fastapi/userdatarefactor 
git pull 
uv sync 
13 (실습) 메모리 기반 Repository 로 구성해보기 fastapi 
https://aws.amazon.com/ko/what-is/repo/ 실습과정 
5. depends 로 서비스와 연결 
user_service 는 user_repository를 
가지고 있어서 user_service(user_repo) 
로 사용법이 복잡해진다 
deps.py 
routes/api/user_routers.py 
실제 사용하는  곳 코드는  바뀌지  않는다 :  DI 의 장점 
git switch feature/fastapi/userdatarefactor 
git pull 
uv sync 
14 deps.py fastapi 
https://aws.amazon.com/ko/what-is/repo/ 의존성을 넣을 때 두가지 방식 
get_user_repository 
이미 만들어진 객체를 넣어주는 방식 
get_user_service 
매번 새로운 객체를 생성해서 넣어주는 방식 
git switch feature/fastapi/userdatarefactor 
git pull 
uv sync 
15 데이터 모델 정리 fastapi 
https://aws.amazon.com/ko/what-is/repo/ 데이터 모델(모양)을 한 곳에 모으는 리팩토링 
데이터 포맷을 알면 서비스 구조를 파악하기 쉽다 
schemas : 유저랑 요청을 주고받는 데이터 
entities: DB와 연결되는 데이터 
git switch feature/fastapi/userdatarefactor 
git pull 
uv sync 

16 데이터 모델 정리 fastapi 
데이터 포맷을 알면 서비스 구조를 파악하기 쉽다 
schemas : 유저랑 요청을 주고받는 데이터 
entities: DB와 연결되는 데이터 
데이터 모델(모양)을 한 곳에 모으는 리팩토링 
git switch feature/fastapi/userdatarefactor 
git pull 
uv sync 
17 계층형(레이어드) 아키텍처 구조 fastapi 
route / service / repository 구조로 책임을 분리 
route 
● 요청 받기 
● 입력 검증 
● service 호출 
service 
● 비즈니스 로직 
● 트랜잭션 제어 
● repository 호출 repository 
● DB 접근 
● SQL 실행 
● 데이터 반환 
core 
● DB 연결 
● 설정 

18 fastapi 와 DI 06 - 02 
객체지향설계와 Dependency(의존성) 
Dependency 와 Dependency Injection 
Service  - Repository 
19 사람의 언어 - 프로그래밍 언어 사이 간극 fastapi 
프로그래밍은 역할과 책임을 나누는 생각 과정 이다 
코드를 어디에다가 작성해야할까? 
역할, 책임, 레이어 
작업을 사용한다, 넘긴다, 위임한다 등 
이런 추상적인 단어(객체지향)가 한글로 들으면 어렵게 느껴진다 
하지만 코드로 보면 굉장히 간단하다 

20 의존성 Dependency fastapi 
A가 B를 가지고 사용하면(가지고 있으면) A는 B에 의존 
class A: 
    b_service : B = new B() 
    fun do_a (): 
        b_service.do_b() 
A 가 하는 일 = A 안의 코드 로직 = A의 책임 
B가 하는 일 = B 안의 코드 로직 = B의 책임 
A가 하는일 을 B한테 넘긴다(일을 맡긴다)  = A 코드를 B로 옮긴다 = 위임한다 
A가 B를 가지고 와서 B의 기능을 실행한다 의존성 (Dependency) 
어떤 기능이  다른 기능을  필요로  하는 관계
21 의존성 Dependency fastapi 
A가 B를 사용하면(가지고 있으면:has-a) A는 B에 의존 
user_router 가 user_service를 사용한다 = user_router는 user_service 에 의존한다 

22 의존성을 직접 생성하면 생기는 문제들 fastapi 
코드가 적으면 객체 생성이 쉽지만 복잡해지면 문제가 생긴다 
하나의  의존성이  변경된다 
1 곳에 쓴다→1 번의 변경
100 곳에 쓴다 → 100 번의 변경
객체를  생성할  때 조건( 파라미터 ) 이 생긴다면 ? 
사용하는  코드가  알 필요 없는 것까지  알아야한다  
테스트하려고 했는데, 
외부 시스템이 같이 따라온다 

23 의존성을 직접 생성하면 생기는 문제들 fastapi 
구현을 직접 생성하면, 나중에 코드 변경이 전파되고 테스트/디버깅이 어려워진다 
변경 전파 
B의 생성 방식/생성자 인자 변경이 A까지 따라온다 
연쇄 의존 
의존성이 깊어질수록(서비스→레포→DB…) 수정 범위가 커진다 
테스트 어려움 
외부 의존(DB/Email)을 쉽게 Mock으로 바꾸기 힘들다 
디버깅 비용 
실패가 “사용 코드”가 아니라 “초기화/주입 내부”에서 터져 원인 추적이 어려워진다 

24 DI: Dependency Injection 이란? fastapi 
https://fastapi.tiangolo.com/ko/reference/dependencies/?h=dep 필요한 객체를 (사용하는 객체가) 직접 만들지 않고 외부에서 넣어주는 방식 
필요한 객체를 
사용하는 쪽에서 직접 만들지 않고 
외부에서 만들어서 전달받는 설계 방식 
의존성을 내가 직접 만들고 있다 
→ 객체 생성 책임까지 함께 가지고 있다 
DI를 사용하면 
→ 객체 생성 책임을 밖으로 분리한다 

25 DI: Dependency Injection 장점 fastapi 
https://fastapi.tiangolo.com/ko/reference/dependencies/?h=dep 객체 생성과 사용이 분리된다 
객체 생성 위치를 한 곳으로 모을 수 있다 
- 생성 규칙(설정, 옵션, 순서)을 중앙에서 관리 
생성 방식이 바뀌어도 수정 범위가 줄어든다 
- "사용하는 코드"는 그대로 두고 "만드는 코드"만 바꾸면 됨 
객체의 생명주기를 FastAPI가 관리해준다 
- 요청마다 새로 만들지 / 재사용할지 선택 가능 
- 요청이 끝나면 자동 정리(cleanup)도 가능 
- 요청 단위로 의존성 라이프사이클을 제어할 수 있다 
dependency_overrides나 mock을 통해 테스트/환경별로 의존성을 교체할 수 있다 
26 FastAPI 에서 DI: Depends() fastapi 
FastAPI DI는 "요청 시점"에 의존성을 실행, 주입하는 방식(함수형태) 
FastAPI Depends는 요청 단위 
의존성의 생명주기를 요청 1번 으로 잡는다 
- 요청이 들어오면 의존성을 만들고 
- 같은 요청 안에서는 재사용하고 
- 요청이 끝나면 자동으로 정리한다 

27 FastAPI 에서 DI: Depends() fastapi 
FastAPI DI는 "요청 시점"에 의존성을 실행, 주입하는 방식(함수형태) 
1. 의존성을 어떻게 만들지 Provider 함수 등록 (정의) 
2. 선언 단계에서 객체 생성 책임을 fastapi 을 넘긴다 (위임) 
- 의존성 주입 
3. 요청 시점에 의존성으로 생성한 객체를 사용한다 

28 (실습) fastapi 에서 DI fastapi 
필요한 객체를 (사용하는 객체가) 직접 만들지 않고 외부에서 받아오는 방식 
1. 의존성을 어떻게 만들지 Provider 함수 등록 (정의) 
2. 선언 단계에서 객체 생성 책임을 fastapi 을 넘긴다 (위임) 
- 의존성 주입 
3. 요청 시점에 의존성으로 생성한 객체를 사용한다 
git switch feature/fastapi/userservicerefactor 
git pull 
uv sync 

29 fastapi 와 ORM 06 - 03 
Service  - Repository 
(docker-compose) mysql 
orm model - table 

30 SQLAlchemy fastapi 
파이썬 ORM DB 연동 라이브러리 
개발 환경 10강 강의 참고 
Repository 는 SQLAlchemy API를 캡슐화 
서비스 단에서는 UserRepository만 보이기 때문에 DB 교체도 가능 
테스트 시 Fake Repository로 교체 가능 → 단위 테스트 강력해짐 
FastAPI 공식 문서, 예제 코드에서도 SQLAlchemy를 기본 조합 

31 (실습) fastapi Repository 와 ORM fastapi 
실습 순서 
1. mysql 실행 (docker) 및 sql 세팅 
infra/mysql/docker-compose.yml 
db 실행 및 user 테이블 sql 적용  (작업이 안되신 경우) 
2. 접속 정보 기반 sqlalchemy 설치 및 fastapi 세팅 
3. model - table mapping 
4. repository 생성 및 query 확인 
5. service 와 연결 git switch feature/fastapi/orm 
git pull 
uv sync 
32 (실습) fastapi DB연결, Repository와 DB fastapi 
실습 진행 
1. mysql 실행 (docker-compose) 
0) docker 실행 
1) 기존 mysql 종료 및 infra/mysql/docker-compose.yml 실행 
cd infra/mysql 
docker-compose up -d 
2) datagrip 읕 통해 접속 및 ddl 실행 
cd ../sql 
ddl
git switch feature/fastapi/orm 
git pull 
uv sync 
33 (실습) fastapi 에 DB연결하고 Repository 로 DB 조작 fastapi 
실습 진행 
2. 접속 정보 기반 sqlalchemy 설치 및 fastapi 세팅 
git switch feature/fastapi/orm 
git pull 
uv sync 
34 (실습) fastapi 에 DB연결하고 Repository 로 DB 조작 fastapi 
실습 순서 
3. model - table mapping 
app/model/entities/base.py 
app/model/entities/user s.py
git switch feature/fastapi/orm 
git pull 
uv sync 
35 (실습) fastapi 에 DB연결하고 Repository 로 DB 조작 fastapi 
실습 순서 
4. repository 생성 및 query 확인 
app/repository/user_repo.py 
5. service 와 연결 
app/service/user_service.py 
app/deps.py 
git switch feature/fastapi/orm 
git pull 
uv sync 
36 (실습) SQLAlchemy 연동된 코드 확인 fastapi 
실습 순서 
6. 결과 확인 
git switch feature/fastapi/orm 
git pull 
uv sync 
37 총정리 fastapi 
FastAPI 와 Layered 아키텍처 
routers - service -  repository - db 
(객체지향) 책임, 위임, 사용 그리고 의존성 
의존성 주입의 장점 
dependency injection 
fastapi + ORM 
www.upstage.ai © 2025 Upstage Co., Ltd. 

