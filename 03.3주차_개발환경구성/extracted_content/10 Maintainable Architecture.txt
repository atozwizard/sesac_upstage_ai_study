SPEAKER
서영학© 2025 Upstage Co., Ltd.
2저작권안내
(주)업스테이지가 제공하는 모든교육콘텐츠의지식재산권은
운영주체인 (주)업스테이지 또는해당저작물의 적법한 관리자에게 귀속되어 있습니다.
콘텐츠 일부 또는 전부를 복사, 복제, 판매, 재판매 공개, 공유 등을 할수없습니다. 
유출될 경우 지식재산권 침해에 대한 책임을 부담할 수있습니다. 
유출에 해당하여 금지되는 행위의 예시는 다음과 같습니다. 
● 콘텐츠를 재가공하여 온/오프라인으로 공개하는 행위
● 콘텐츠의 일부 또는 전부를 이용하여 인쇄물을 만드는 행위
● 콘텐츠의 전부 또는 일부를 녹취 또는 녹화하거나 녹취록을 작성하는 행위
● 콘텐츠의 전부 또는 일부를 스크린 캡쳐하거나 카메라로 촬영하는 행위
● 지인을 포함한 제3자에게 콘텐츠의 일부 또는 전부를 공유하는 행위
● 다른 정보와 결합하여 Upstage Education의 콘텐츠임을 알아볼 수있는 저작물을 작성, 공개하는 행위
● 제공된 데이터의 일부 혹은전부를 Upstage Education 프로젝트/실습 수행 이외의 목적으로 사용하는 행위위
3목표: 역할별로레이어를나누고DB를편하게쓰자계층형아키텍처와ORM
목차
역할별로나눈계층형아키텍처소개
mysql table과model의괴리: ORM
SQLAlchemy 사용법
4현상황진단계층형아키텍처
main.py 에모든로직이몰려있다
main.py 가너무비대해진다
•수정이 어렵다
•테스트 어렵다
•역할이 모호하다

510 -01
-역할에맞는레이어분리
-api layer -service layer -repository layer 책임분리
6현상황진단계층형아키텍처
https://www.codeit.kr/tutorials/194/mvc-pattern-and-layered-architecturemain.py 에로직을 역할별로생각
•실행하는 부분(요청받는부분)
•DB 연결만들기
•SQL 실행
•비즈니스 로직처리
•응답생성
7계층형(레이어드) 아키텍처구조계층형아키텍처
route / service / repository 구조로 책임을 분리
route
•요청받기
•입력검증
•service 호출
service
•비즈니스 로직
•트랜잭션 제어
•repository 호출repository
•db 접근
•sql 실행
•데이터 반환
core
•db 연결
•설정
8(실습) 레이어드아키텍처구조로변경계층형아키텍처
실습순서
1. 패키지구조먼저
2. main.py 에있는db 관련소스
(connection, connection_pool) core 로이전
3. main.py 안에있는db 쿼리호출repository chat/user로구분해서이동
4. main.py main 실행부분route/cli_routes.py 로이동
5. cli_routes.py 에서실행할service 파일chat/user 로구분해서생성
6. main 지우고cli_routes.py 를통해작업실행

9(실습) layer = 계층, 우선패키지구조부터잡자계층형아키텍처
실습과정
1. 패키지 구조먼저
app 폴더안에묶은이유
-애플리케이션코드를한곳
-프로젝트의실제동작로직(개발자가만든)이들어가는영역
•api (라우트)
•service (비즈니스로직)
•repository (DB 처리)
•core (환경, 설정)
•models (데이터구조)
git switch feature/layered/start
git pull
uv sync
10(실습) 레이어드아키텍처구조로변경계층형아키텍처
실습과정
2. main.py 에있는db 관련소스(connection, connection_pool) core 로이전
3. main.py 안에있는db 쿼리호출repository chat/user로구분해서 이동
git switch feature/layered/refactor
git pull
uv sync
11(실습) 레이어드아키텍처구조로변경계층형아키텍처
실습과정
4. main.py main 실행부분 route/cli_routes.py 로이동
5. cli_routes.py 에서실행할 service 파일chat/user 로구분해서 생성
6. main 지우고cli_routes.py 를통해작업실행
git switch feature/layered/complete
git pull
uv sync
12역할을분리하고계층화하여복잡도를낮춘다.계층형아키텍처
한레이어는 한가지책임에만 집중하게 하자
변경영향최소화: DB가바뀌어도 Service 로직은 그대로
테스트용이: Service를DB 없이도 단위테스트가능
읽기쉬운흐름: "요청→ 서비스→ 저장소"로 생각하기 쉬움
역할을분리하고 계층화하여 복잡도를 낮춘다.
안전성과 유지보수성을 높이기 위한설계철학기반.
각계층간명확한 책임분리(Separation of Concerns) 지향

1310 -02
table 과model
14코드에SQL 를그대로쓴다면? ORM
raw sql 반복증가
repository 복잡증가
필드추가시sql 수정 필요
유지보수비용증가
서비스성장대비어려움
table 을코드와매핑해볼수있을까?

15ORM 이란?ORM
객체지향프로그래밍 언어의객체와
관계형데이터베이스의 테이블을 자동으로 연결(Mapping)해주는 기술
SQL 대신객체중심의코드로데이터조작
코드의변경→ DB 변경스트레스최소화
16ORM이제공하는핵심기능ORM
ORM 을쓰면좋은점들
객체와테이블의매핑: 클래스↔ 테이블, 객체필드↔ 테이블컬럼연결자동화
CRUD 기능자동화: 생성(Create), 읽기(Read), 수정(Update), 삭제(Delete) 작업을객체중심으로제공
영속성관리(Persistence Context): 객체의상태(생성, 수정, 삭제)를추적하고DB에자동동기화
트랜잭션관리: 데이터의일관성보장(Transaction commit, rollback 자동관리)
객체지향쿼리지원: JPQL(자바), Django ORM(Python) 등객체중심의쿼리제공
17SQLAlchemy 이란?ORM
python 기반ORM 도구
개발자가SQL 쿼리문을직접작성하는대신, 파이썬객체지향코드를사용하여데이터베이스와상호작용
할수있도록도와준다
ORM 기능외에도, 파이썬코드로SQL 표현식을구성하고실행할수있는저수준(low-level) 기능을제공
다양한데이터베이스시스템(SQLite, PostgreSQL, MySQL, Oracle, Microsoft SQL Server 등)을지원
Session객체를통해데이터베이스연결을관리하고트랜잭션을효율적으로제어
18SQLAlchemy 구성요소: Engine ORM
Engine
데이터베이스와의실제연결을담당하는객체
커넥션풀관리
DB URL 기반생성
모든ORM 동작의출발점
19SQLAlchemy 구성요소: Session ORM
Session
ORM 작업단위(트랜잭션포함)
add / commit / rollback / query 실행
DB 연결을추상화한고수준API
20SQLAlchemy 구성요소: Base ModelORM
Base Model
ORM 테이블매핑의부모클래스
Column, Integer, String 등SQLAlchemy 타입정의
클래스= 테이블구조표현
21SQLAlchemy: ORM MappingORM
db 테이블→ 객체클래스 매핑

22SQLAlchemy 에서Model을통해쿼리요청하기ORM
CRUD
ORM에서 CRUD는SQL을직접쓰는대신Python 객체를추가·조회·수정·삭제하는방식
insert: session.add(model)
select: session.query(Model).filter().first() / all()
update: 객체수정후commit
delete: session.delete(instance) 후commit
23INSERTORM
INSERT
session = SessionLocal()
user = User(name="kim", email="kim@test.com")
session.add(user)
session.commit()        # 실제INSERT 발생
session.refresh(user)   # DB가생성한PK(id) 등최신값적용
24SELECTORM
SELECT
session = SessionLocal()
# 단일조회
user = session.query(User).filter(User.email == "kim@test.com").first()
# 여러개조회
users = session.query(User).all()
# 특정조건조회
users = session.query(User).filter(User.name == "kim").all()
25UPDATEORM
UPDATE
user = session.query(User).filter(User.id == 1).first()
user.name = "lee"     # 객체필드수정
session.commit()      # UPDATE SQL 자동실행
26DELETEORM
DELETE
user = session.query(User).filter(User.id == 1).first()
session.delete(user)
session.commit()
27(실습) sqlalchemy 로기존query를orm 으로변경ORM
실습순서
1. sqlalchemy 설치
2. sqlalchemy 연결, 기존connection 객체를sql_alchemy 객체로변경
3. user, conversation 테이블모델매핑
4. user, conversation  query 수정
5. serializer 를통해응답값수정

28(실습) sqlalchemy 로기존query를orm 으로변경ORM
실습순서
1. sqlalchemy 설치
uv add sqlalchemy
2. sqlalchemy 연결, 기존connection 객체를sql_alchemy 객체로변경(app/core/db.py)
3. user, conversation 테이블모델매핑
app/models/base.py
app/models/user.py
git switch feature/orm/conn
git pull
uv sync
29(실습) sqlalchemy 로기존query를orm 으로변경ORM
실습순서
4. user, conversation  query 수정git switch feature/orm/query
git pull
uv sync
app/repository/user_repository.py
305. serializer 를통해응답값수정ORM
실습과정
기존응답
json 형태( map/dict ) 로바꾸기위한라이브러리설치
uv add sqlalchemy-serializer
table 모델코드에반영
결과
git switch feature/orm/serializer
git pull
git sync
31총정리계층형아키텍처와ORM
역할에따라코드를 layer로나눌수있다
Route, Service, Repository
ORM 필요성과 SQLAlchemy 통해ORM 구현하기
Table과Model 연결(Mapping)
Model 을통해SQL 쿼리요청하기
ORM 은Repository의책임
32Complete
33개발환경수업총정리개발환경
개발환경개선
혼자하는 개발에서 여럿이
git commit, branch 
github
issue -pr -code review -mergeIDE, 개발도구들
uv, pyproject.toml외부의존성 다루기
docker 구성요소사용법
docker-compose
DB 을통한데이터 관리
SQL 사용법, Where 최적화
DB 연결관리앞으로 개발 속도 + 공부 속도를 높여줄 개발 환경 개선
유지보수를 위한리팩토링
코드책임에따른리팩토링
테이블과 객체 관계 ORM 
www.upstage.ai © 2025 Upstage Co., Ltd.

